<!DOCTYPE html>
<html>
<title>Grupo 13 - Desarrollo de Software en Sistemas Distribuidos</title>
<xmp theme="cerulean" style="display:none;">
# API de Incidentes

  Esta API consiste en un webservice REST que brinda un servicio de solicitud de presupuestos

  Esta implementado utilizando las tecnologias PHP, Apache y el framework Slim

  # Endpoints

1. `'/'` --> Documentación

Un requerimiento `HTTP GET` a la URL `'/'` retorna este documento

2. `'/incidente/{:id}'` --> Retorna los datos de un incidente

Se debe enviar un requerimiento `HTTP GET` a la URL `/incidente/{:id}`.

El parametro fecha incluido en la URL debe ser el identificador del incidente que se quiere consultar

La respuesta es un objeto `JSON` que contiene los datos del incidente:

    HTTP 200 OK

```JSON
{
    "idIncidente": "1",
    "idUsuario": "1",
    "idTipoIncidente": "1",
    "descripcion": "incendio ",
    "estado": "1",
    "fechaInicio": "03-11-2017"
}
```

3. `'/incidentes'` --> Retorna la lista de incidentes

Se debe enviar un requerimiento `HTTP GET` a la URL `/incidente`.

El parametro fecha incluido en la URL debe ser el identificador del incidente que se quiere consultar

La respuesta es un array de objetos `JSON` que contiene los datos de los incidentes:

    HTTP 200 OK

```JSON
[
    {
        "idIncidente": "1",
        "idUsuario": "1",
        "idTipoIncidente": "1",
        "descripcion": "incendio ",
        "estado": "1",
        "fechaInicio": "03-11-2017"
    },
    {
        "idIncidente": "2",
        "idUsuario": "1",
        "idTipoIncidente": "2",
        "descripcion": " choque",
        "estado": "1",
        "fechaInicio": "03-11-2017"
    }
]
```

4. `'/incidentes/{:id_usuario}'` --> Retorna la lista de incidentes de un usuario

Se debe enviar un requerimiento `HTTP GET` a la URL `/incidentes/{:id_usuario}`.

El parametro fecha incluido en la URL debe ser el identificador del usuario que se quiere consultar

La respuesta es un array de objetos `JSON` que contiene los datos de los incidentes:

    HTTP 200 OK

```JSON
[
    {
        "idIncidente": "1",
        "idUsuario": "1",
        "idTipoIncidente": "1",
        "descripcion": "incendio ",
        "estado": "1",
        "fechaInicio": "03-11-2017"
    },
    {
        "idIncidente": "2",
        "idUsuario": "1",
        "idTipoIncidente": "2",
        "descripcion": " choque",
        "estado": "1",
        "fechaInicio": "03-11-2017"
    }
]
```

5. `'/incidentes'` --> Registrar incidente

Se debe enviar un requerimiento `HTTP POST` a la URL `/incidentes`.

La solicitud debe incluir en el `body` un objeto `JSON` en donde se indiquen los siguientes parametros: IdUsuario, IdTipoIncidente, Fecha, Descripcion

Ejemplo:

    HTTP 200 OK

```JSON
{
  "idUsuario": "1",
  "idTipoIncidente": "2",
  "descripcion": "choque"
}
```
Los cuatro parametros serán validados:

* `IdUsuario` debe ser el de un usuario registrado en el sistema
* `idTipoIncidente` debe ser alguno de los identificadores de tipo de incidentes
* `descripcion`: string

  Esto devuelve una respuesta en donde el `body` es un objeto `JSON` con la siguiente estructura:

    HTTP 200 OK

```JSON
{
    "error_code": "integer",
    "message": "string",
    "idIncidente": "integer"
}
```
Donde:

* `message`: contiene un texto descriptivo del resultado de la operación
* `idIncidente`: contiene un `id` que es el identificador asignado por el sistema
* `error_code`: este campo unicamente se incluye  cuando la respuesta `HTTP` vuelve con un `Status Code 400 Bad Request`. Es un codigo de error cuyo significado puede consultarse en el endpoint `/error_code/{:id_error_code}`

#### Ejemplo incidente creado correctamente:

    HTTP 200 OK

```JSON
{
    "message": "Se confirmó el expediente # 2",
    "idIncidente": "2"
}
```
#### Ejemplo error:

    HTTP 400 Bad Request

```JSON
{
    "error_code": "1",
    "message": "El usuario indicado no existe en el sistema",
    "idIncidente": ""
}
```

6. `'/tipos-incidente'` --> Retorna la lista de tipos de incidentes

Se debe enviar un requerimiento `HTTP GET` a la URL `/tipos-incidente/{:id}`.

El parametro fecha incluido en la URL debe ser el identificador del incidente que se quiere consultar

La respuesta es un array de objetos `JSON` que contiene los datos de los incidentes:

    HTTP 200 OK

```JSON
[
    {
        "idTipoIncidente": "1",
        "nombre": "casa"
    },
    {
        "idTipoIncidente": "2",
        "nombre": "vehiculo"
    },
    {
        "idTipoIncidente": "3",
        "nombre": "objeto-mueble"
    }
]
```

7. `'/error_code/{:id_error_code}'` --> Consulta de código de error

Se debe enviar un requerimiento `HTTP GET` a la URL `/error_code/{:id_error_code}`.

El parametro fecha incluido en la URL es un identificador del código de error que se quiere consutlar

La respuesta es un objeto `JSON` con la siguiente estructura:

    HTTP 200 OK

```JSON
{
  "id": "1",
  "description": "El turno solicitado ya se encuentra ocupado"
}
```

  # Instalación

1. Se agrega un `Virtual-Host` al servidor de Apache2, en este ejemplo la API se registra en el dominio `api-incidentes.com`

  Crear el archivo `/etc/apache2/sites-available/api-incidentes.com.conf` con el contenido:

  ```xml
  <VirtualHost *:80>
      ServerAdmin webmaster@localhost
      ServerName api-incidentes.com
      ServerAlias www.api-incidentes.com
      DocumentRoot /var/www/html/api-incidentes.com

      <Directory /var/www/html/api-incidentes.com/>
          Options Indexes FollowSymLinks
          AllowOverride All
          Require all granted
      </Directory>
    </VirtualHost>
  ```

  `Nota: El directorio /var/www/html/api-incidentes.com debe existir`

2. Ejecutar los comandos en una terminal (los dos primeros pueden no ser necesarios si ya se ejecutaron alguna vez):

  ```
  sudo a2enmod rewrite

  sudo a2dissite 000-default.conf

  sudo a2ensite api-incidentes.com
  ```

3. Agregar en hosts: `/etc/hosts`

  ```
  127.0.0.1 api-incidentes.com
  ```

4. Luego reiniciar el servicio de Apache

  ```
    systemctl restart apache2
```
</xmp>
<script src="http://strapdownjs.com/v/0.2/strapdown.js"></script>
</html>
